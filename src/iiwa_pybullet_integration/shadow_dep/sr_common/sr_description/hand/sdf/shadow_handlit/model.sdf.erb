<?xml version='1.0'?>
<%
require 'matrix'
require 'erb'
require 'yaml'

class Base
    #constants
    M_PI = 3.1415926535897931
    attr_accessor :forearm,:palm,:mesh_c,:mesh_v
    def initialize(sim_env)
        @forearm ={  # object pose
                    'pose'=> [0,0,0,
                                   0,0,M_PI/2],
                    # inetia 
                    'pose_i'=> [0,0,0.09,
                                     0,0,0],                   
                    'mass'=> 1.8,
                    'ixx'=> 0.108 ,'ixy'=> 0     ,'ixz'=> 0 ,
                    'iyy'=> 0.108 ,'iyz'=> 0     ,'izz'=> 0.054 ,
                    #color
                    "ambient"=>  [0,0,0,1],
                    "diffuse"=>  [0,0,0,1],
                    "specular"=> [0,0,0,1],
                    "emissive"=> [0,0,0,0]
        }

        @palm =  {  # object pose
                'pose'=> [0+forearm['pose'][0],
                         -0.015+forearm['pose'][1],
                          0.149+forearm['pose'][2],
                         -40*M_PI/180,0,0],
                # inetia 
                'pose_i'=> [0,0,0.035,
                                0,0,0],                   
                'mass'=> 0.3,
                'ixx'=> 0.0003581 ,'ixy'=> 0     ,'ixz'=> 0 ,
                'iyy'=> 0.0005287 ,'iyz'=> 0     ,'izz'=> 0.000191 ,
                #color
                "ambient"=>  [0,0,0,1],
                "diffuse"=>  [0,0,0,1],
                "specular"=> [0,0,0,1],
                "emissive"=> [0,0,0,0]
        }
        def loadYamlAndChange()
            file = YAML.load_file("config.yml")
            #print file 
         
                
            #print finger
            links = file["BASE"]["Links"]
            links.each do |linkName,link|

                color = link["color"]
                mass  = link["mass"]
                if !(linkName == "forearm")
                    joint = link["joint"]
                end
                

                if linkName == "forearm"
                    #visual
                    @forearm["ambient"] = color["ambient"]
                    @forearm["diffuse"] = color["diffuse"]
                    @forearm["specular"] = color["specular"]
                    @forearm["emissive"] = color["emissive"]
                    #physical prop
                    @forearm["mass"] = mass


                elsif linkName== "palm"
                    #visual
                    @palm["ambient"] = color["ambient"]
                    @palm["diffuse"] = color["diffuse"]
                    @palm["specular"] = color["specular"]
                    @palm["emissive"] = color["emissive"]
                    #physical prop
                    @palm["mass"] = mass


                end
            end
              
            
        end
        loadYamlAndChange()
        path_v ={
            "palm"      => "meshes/palm.dae",
            "forearm"   =>"meshes/forearm_lite.dae",
    
        }
        path_c ={
            "palm"      => "meshes/palm.dae",
            "forearm"   =>"meshes/forearm_lite.dae",
              
        }
        @mesh_c={}
        @mesh_v={}
        
        if sim_env == "gazebo"
            #model://+default path
            path_c.each do |key,value|
              @mesh_c.merge!({key => "model://shadow_handlit/"+value})
            end
            path_v.each do |key,value|
              @mesh_v.merge!({key => "model://shadow_handlit/"+value})
            end
        
        elsif sim_env == "pybullet"
            #deafult path
            @mesh_v = path_v
            @mesh_c = path_c
        else
            puts "Fingers:   well life sucks!not everything is supported.A'nt life a bitch? "
        end 
    end
end
class Finger
    #constants
    M_PI = 3.1415926535897931
    attr_accessor :knuckle,:proximal,:middle,:distal,:palm,:fingername,:mesh_c,:mesh_v
    def initialize(sim_env,palm,biase,fingername)
        @fingername = fingername
        @palm = palm
        @knuckle ={ # object pose
                    'pose'=> [-0.033+palm['pose'][0]+biase[0],
                            0.0611+palm['pose'][1]+biase[1],
                            0.07277+palm['pose'][2]+biase[2],
                            0,0,0],
                    # inetia 
                    'pose_i'=> [0,0,0,
                                0,0,0],                   
                    'mass'=> 0.008,
                    'ixx'=> 0.00000026 ,'ixy'=> 0     ,'ixz'=> 0 ,
                    'iyy'=> 0.00000026 ,'iyz'=> 0     ,'izz'=>0.00000032,
                    # joint 
                    "name"       =>"knuckle",
                    "p_name"       =>"palm",
                    "j_name"     =>"J4",
                    "j_type"     =>"revolute",
                    "j_axis"     => [0,-1,0],
                    "j_limit"    => [-20/180*M_PI,20/180*M_PI], #[lower,upper]
                    "j_effort"   => 2.0,
                    "j_velocity" => 2.0,
                    "j_damping"  => 0.1 ,
                    #color
                    "ambient"=>  [0,0,0,1],
                    "diffuse"=>  [0,0,0,1],
                    "specular"=> [0,0,0,1],
                    "emissive"=> [0,0,0,0]
        }
        @proximal = {  # object pose
                      'pose'=> [0+knuckle['pose'][0],
                              0+knuckle['pose'][1],
                              0+knuckle['pose'][2],
                              0,0,0],
                      # inetia 
                      'pose_i'=> [0,0,0.0225,
                                      0,0,0],                   
                      'mass'=> 0.030,
                      'ixx'=> 0.0000098 ,'ixy'=> 0     ,'ixz'=> 0 ,
                      'iyy'=> 0.00001 ,'iyz'=> 0     ,'izz'=>0.0000018 ,
                       # joint 
                       "name"       =>"proximal",
                       "p_name"     =>"knuckle",
                       "j_name"     =>"J3",
                       "j_type"     =>"revolute",
                       "j_axis"     => [1,0,0],
                       "j_limit"    => [0,M_PI/2], #[lower,upper]
                       "j_effort"   => 2.0,
                       "j_velocity" => 2.0,
                       "j_damping"  => 0.1 ,
                        #color
                        "ambient"=>  [0,0,0,1],
                        "diffuse"=>  [0,0,0,1],
                        "specular"=> [0,0,0,1],
                        "emissive"=> [0,0,0,0]
                       
        } 
        @middle =   {  # object pose
                      'pose'=> [0+proximal['pose'][0],
                              0+proximal['pose'][1],
                              0.045+proximal['pose'][2],
                              0,0,0],
                      # inetia 
                      'pose_i'=> [0,0,0.0125,
                                      0,0,0],                   
                      'mass'=> 0.017,
                      'ixx'=>0.0000026 ,'ixy'=> 0     ,'ixz'=> 0 ,
                      'iyy'=>0.0000027 ,'iyz'=> 0     ,'izz'=>0.00000087,
                      # joint 
                      "name"       =>"middle",
                      "p_name"     =>"proximal",
                      "j_name"     =>"J2",
                      "j_type"     =>"revolute",
                      "j_axis"     => [1,0,0],
                      "j_limit"    => [0,M_PI/2], #[lower,upper]
                      "j_effort"   => 2.0,
                      "j_velocity" => 2.0,
                      "j_damping"  => 0.1 ,
                      #color
                      "ambient"=>  [0,0,0,1],
                      "diffuse"=>  [0,0,0,1],
                      "specular"=> [0,0,0,1],
                      "emissive"=> [0,0,0,0]
        }
        @distal =   {  # object pose
                        'pose'=> [0+middle['pose'][0],
                                  0+middle['pose'][1],
                                  0.025+middle['pose'][2],
                                  0,0,0],
                        # inetia 
                        'pose_i'=> [0,0,0.012,
                                        0,0,0],                   
                        'mass'=> 0.012,
                        'ixx'=>0.00000094 ,'ixy'=> 0     ,'ixz'=> 0 ,
                        'iyy'=>0.0000011 ,'iyz'=> 0     ,'izz'=>0.00000053,
                        # joint 
                        "name"       =>"distal",
                        "p_name"     =>"middle",
                        "j_name"     =>"J1",
                        "j_type"     =>"revolute",
                        "j_axis"     => [1,0,0],
                        "j_limit"    => [0,M_PI/2], #[lower,upper]
                        "j_effort"   => 2.0,
                        "j_velocity" => 2.0,
                        "j_damping"  => 0.1 ,
                        #color
                        "ambient"=>  [0,0,0,1],
                        "diffuse"=>  [0,0,0,1],
                        "specular"=> [0,0,0,1],
                        "emissive"=> [0,0,0,0]
        }
        def loadYamlAndChange()
            file = YAML.load_file("config.yml")
            #print file 
         
                
            #print finger
            links = file[ @fingername]["Links"]
            links.each do |linkName,link|

                color = link["color"]
                mass  = link["mass"] 
                joint = link["joint"]

                if linkName == "knuckle"
                    #visual
                    @knuckle["ambient"] = color["ambient"]
                    @knuckle["diffuse"] = color["diffuse"]
                    @knuckle["specular"] = color["specular"]
                    @knuckle["emissive"] = color["emissive"]
                    #physical prop
                    @knuckle["mass"] = mass
                    @knuckle["j_damping"] = joint["damping"]
                    @knuckle["j_friction"] = joint["friction"]
                elsif linkName== "proximal"
                    #visual
                    @proximal["ambient"] = color["ambient"]
                    @proximal["diffuse"] = color["diffuse"]
                    @proximal["specular"] = color["specular"]
                    @proximal["emissive"] = color["emissive"]
                    #physical prop
                    @proximal["mass"] = mass
                    @proximal["j_damping"] = joint["damping"]
                    @proximal["j_friction"] = joint["friction"]
                elsif linkName== "middle"
                    #visual
                    @middle["ambient"] = color["ambient"]
                    @middle["diffuse"] = color["diffuse"]
                    @middle["specular"] = color["specular"]
                    @middle["emissive"] = color["emissive"]
                    #physical prop
                    @middle["mass"] = mass
                    @middle["j_damping"] = joint["damping"]
                    @middle["j_friction"] = joint["friction"]
                elsif linkName== "distal"
                    #visual
                    @distal["ambient"] = color["ambient"]
                    @distal["diffuse"] = color["diffuse"]
                    @distal["specular"] = color["specular"]
                    @distal["emissive"] = color["emissive"]
                    #physical prop
                    @distal["mass"] = mass
                    @distal["j_damping"] = joint["damping"]
                    @distal["j_friction"] = joint["friction"]
                end
            end
              
            
        end
        loadYamlAndChange()
        path_c = {  "distal"   => "meshes/F1.dae",
                    "middle"   => "meshes/F2.dae",
                    "proximal" => "meshes/F3.dae",
                    "knuckle"  => "meshes/knuckle.dae",
                    "palm"     => "meshes/palm.dae",
                    "forearm"  => "meshes/forearm_lite.dae",
        }
        path_v = {  "distal"   => "meshes/F1.dae",
                    "middle"   => "meshes/F2.dae",
                    "proximal" => "meshes/F3.dae",
                    "knuckle"  => "meshes/knuckle.dae"
        }
        @mesh_c={}
        @mesh_v={}
        if sim_env == "gazebo"
          #model://+default path
          path_c.each do |key,value|
            @mesh_c.merge!({key => "model://shadow_hand/"+value})
          end
          path_v.each do |key,value|
            @mesh_v.merge!({key => "model://shadow_hand/"+value})
          end

        elsif sim_env == "pybullet"
          #deafult path
          @mesh_v = path_v
          @mesh_c = path_c
        else
          puts "well life sucks!not everything is supported.A'nt life a bitch? "
        end
            
    end
end

class Thumb
    attr_accessor :thbase,:thproximal,:thhub,:thmiddle,:thdistal,:palm,:mesh_c,:mesh_v
    #constants
    M_PI = 3.1415926535897931
    def initialize(sim_env,palm)
        @palm = palm
        @thbase =  {# object pose
                    'pose'=> [-0.034+palm['pose'][0],
                    0.0085+palm['pose'][1],
                    0.029+palm['pose'][2],
                            0,0,0],
                    # inetia 
                    'pose_i'=> [0,0,0,
                                0,0,0],                   
                    'mass'=> 0.010,
                    'ixx'=> 0.00000016 ,'ixy'=> 0     ,'ixz'=> 0 ,
                    'iyy'=> 0.00000016 ,'iyz'=> 0     ,'izz'=>0.00000016 ,
                    # joint 
                    "name"       =>"thbase",
                    "p_name"       =>"palm",
                    "j_name"     =>"THJ5",
                    "j_type"     =>"revolute",
                    "j_axis"     => [0,0,1],
                    "j_limit"    => [-60/180*M_PI,60/180*M_PI], #[lower,upper]
                    "j_effort"   => 0.2,
                    "j_velocity" => 4.0,
                    "j_damping"  => 0.2,
                    #visual
                    "ambient"=>  [0,0,0,1],
                    "diffuse"=>  [0,0,0,1],
                    "specular"=> [0,0,0,1],
                    "emissive"=> [0,0,0,0]
                        
    
        } 
        @thproximal ={# object pose
                    'pose'=> [0+thbase['pose'][0],
                            0+thbase['pose'][1],
                            0+thbase['pose'][2],
                            0,0,0],
                    # inetia 
                    'pose_i'=> [0,0,0.019,
                                0,0,0],                   
                    'mass'=> 0.040,
                    'ixx'=> 0.0000136 ,'ixy'=> 0     ,'ixz'=> 0 ,
                    'iyy'=> 0.0000136 ,'iyz'=> 0     ,'izz'=>0.00000313,
                    # joint 
                    "name"       =>"thproximal",
                    "p_name"     =>"thbase",
                    "j_name"     =>"THJ4",
                    "j_type"     =>"revolute",
                    "j_axis"     => [1,0,0],
                    "j_limit"    => [0,70/180*M_PI], #[lower,upper]
                    "j_effort"   => 3.0,
                    "j_velocity" => 4.0,
                    "j_damping"  => 0.2,
                    #visual
                    "ambient"=>  [0,0,0,1],
                    "diffuse"=>  [0,0,0,1],
                    "specular"=> [0,0,0,1],
                    "emissive"=> [0,0,0,0]                    
        } 
        @thhub = {  # object pose
                    'pose'=> [0+thproximal['pose'][0],
                            0+thproximal['pose'][1],
                            0.038+thproximal['pose'][2],
                            0,0,0],
                    # inetia 
                    'pose_i'=> [0,0,0,
                                0,0,0],                   
                    'mass'=> 0.005,
                    'ixx'=> 0.000001 ,'ixy'=> 0     ,'ixz'=> 0 ,
                    'iyy'=> 0.000001 ,'iyz'=> 0     ,'izz'=>0.0000003 ,
                    # joint 
                    "name"       =>"thhub",
                    "p_name"     =>"thproximal",
                    "j_name"     =>"THJ3",
                    "j_type"     =>"fixed",
                    "j_axis"     => [1,0,0]
                }
        @thmiddle = {# object pose
                    'pose'=> [0+thhub['pose'][0],
                            0+thhub['pose'][1],
                            0.01+thhub['pose'][2],
                            0,0,0],
                    # inetia 
                    'pose_i'=> [0,0,016,
                                0,0,0],                   
                    'mass'=> 0.020,
                    'ixx'=> 0.0000051 ,'ixy'=> 0     ,'ixz'=> 0 ,
                    'iyy'=> 0.0000051 ,'iyz'=> 0     ,'izz'=>0.00000121 ,
                    # joint 
                    "name"       =>"thmiddle",
                    "p_name"     =>"thhub",
                    "j_name"     =>"THJ2",
                    "j_type"     =>"revolute",
                    "j_axis"     => [0,-1,0],
                    "j_limit"    => [-40/180*M_PI,40/180*M_PI], #[lower,upper]
                    "j_effort"   => 2.0,
                    "j_velocity" => 2.0,
                    "j_damping"  => 0.1,
                    #visual
                    "ambient"=>  [0,0,0,1],
                    "diffuse"=>  [0,0,0,1],
                    "specular"=> [0,0,0,1],
                    "emissive"=> [0,0,0,0]
        } 
        @thdistal = {# object pose
                   'pose'=> [0+thmiddle['pose'][0],
                           0+thmiddle['pose'][1],
                           0.032+thmiddle['pose'][2],
                           0,0,M_PI/2],
                   # inetia 
                   'pose_i'=> [0,0,01375,
                               0,0,0],                   
                   'mass'=> 0.016,
                   'ixx'=> 0.0000021 ,'ixy'=> 0     ,'ixz'=> 0 ,
                   'iyy'=> 0.0000022 ,'iyz'=> 0     ,'izz'=>0.000001 ,
                    # joint 
                    "name"       =>"thdistal",
                    "p_name"     =>"thmiddle",
                    "j_name"     =>"THJ1",
                    "j_type"     =>"revolute",
                    "j_axis"     => [1,0,0],
                    "j_limit"    => [0,90.0*M_PI/180], #[lower,upper]
                    "j_effort"   => 1.0,
                    "j_velocity" => 4.0,
                    "j_damping"  => 0.2,
                    #visual
                    "ambient"=>  [0,0,0,1],
                    "diffuse"=>  [0,0,0,1],
                    "specular"=> [0,0,0,1],
                    "emissive"=> [0,0,0,0]
        }
        def loadYamlAndChange()
            file = YAML.load_file("config.yml")
            #print file 
         
                
            #print finger
            links = file["TH"]["Links"]
            links.each do |linkName,link|

                color = link["color"]
                mass  = link["mass"] 
                joint = link["joint"]

                if linkName == "thbase"
                    #visual
                    @thbase["ambient"] = color["ambient"]
                    @thbase["diffuse"] = color["diffuse"]
                    @thbase["specular"] = color["specular"]
                    @thbase["emissive"] = color["emissive"]
                    #physical prop
                    @thbase["mass"] = mass
                    @thbase["j_damping"] = joint["damping"]
                    @thbase["j_friction"] = joint["friction"]
                elsif linkName== "thproximal"
                    #visual
                    @thproximal["ambient"] = color["ambient"]
                    @thproximal["diffuse"] = color["diffuse"]
                    @thproximal["specular"] = color["specular"]
                    @thproximal["emissive"] = color["emissive"]
                    #physical prop
                    @thproximal["mass"] = mass
                    @thproximal["j_damping"] = joint["damping"]
                    @thproximal["j_friction"] = joint["friction"]
                elsif linkName== "thhub"
                    #physical prop
                    @thhub["mass"] = mass
                    @thhub["j_damping"] = joint["damping"]
                    @thhub["j_friction"] = joint["friction"]
                elsif linkName== "thmiddle"
                    #visual
                    @thmiddle["ambient"] = color["ambient"]
                    @thmiddle["diffuse"] = color["diffuse"]
                    @thmiddle["specular"] = color["specular"]
                    @thmiddle["emissive"] = color["emissive"]
                    #physical prop
                    @thmiddle["mass"] = mass
                    @thmiddle["j_damping"] = joint["damping"]
                    @thmiddle["j_friction"] = joint["friction"]
                elsif linkName== "thdistal"
                    #visual
                    @thdistal["ambient"] = color["ambient"]
                    @thdistal["diffuse"] = color["diffuse"]
                    @thdistal["specular"] = color["specular"]
                    @thdistal["emissive"] = color["emissive"]
                    #physical prop
                    @thdistal["mass"] = mass
                    @thdistal["j_damping"] = joint["damping"]
                    @thdistal["j_friction"] = joint["friction"]
                end
            end
              
            
        end
        loadYamlAndChange()
        path_v = {
                'thproximal' => "meshes/TH3_z.dae",
                'thmiddle'   => "meshes/TH2_z.dae",
                'thdistal'   => "meshes/TH1_z.dae"
        }
        path_c = {
                'thproximal' => "meshes/TH3_z.dae",
                'thmiddle'   => "meshes/TH2_z.dae",
                'thdistal'   => "meshes/TH1_z.dae"
        }
        @mesh_c ={}
        @mesh_v ={}
        
        if sim_env == "gazebo"
          #model://+default path
          path_c.each do |key,value|
            @mesh_c.merge!({key => "model://shadow_hand/"+value})
          end
          path_v.each do |key,value|
            @mesh_v.merge!({key => "model://shadow_hand/"+value})
          end
  
        elsif sim_env == "pybullet"
          #deafult path
          @mesh_v = path_v
          @mesh_c = path_c
        else
          puts "well life sucks!not everything is supported.A'nt life a bitch? "
        end


            
    end
end
      
def a_to_s(v)#converts array to string
        Array(v).join(" ")
end
      #####################################hand setting######################
      #sim env setting
      sim_env ="pybullet" #change to pybullet|gazebo 

      base = Base.new(sim_env)
      #finger
      # This value move the finger object in x y z         
      biase = [0,0,0]
      ff = Finger.new(sim_env,base.palm,biase,"FF")
      biase = [0.022,0,0.004]
      mf =  Finger.new(sim_env,base.palm,biase,"MF")
      biase = [0.044,0,0]
      rf  = Finger.new(sim_env,base.palm,biase,"RF")
      fingers =[ff,mf,rf]
      #finger joints
      #knucle is exclided and defined on its own
      j_finger_L = [ff.proximal,ff.middle,ff.distal]#axis tag for all the fingers are all the same. so gonna take one of them for all
      
      #thumb
      thumb = Thumb.new(sim_env,base.palm)
      #thumb joints
      #thhub is not included becuase it has a fixed joint
      j_thumb_L = [thumb.thbase,thumb.thproximal,thumb.thmiddle,thumb.thdistal]
       


%>
<sdf version='1.6'>

<model name='shadow_handlit'>
    <static>false</static>
    <link name = "forearm_link">
        <pose frame=''><%=a_to_s(base.forearm['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(base.forearm['pose_i'])%></pose>
            <mass><%=base.forearm['mass']%></mass>
            <inertia>
                <ixx><%=base.forearm['ixx']%></ixx>
                <ixy><%=base.forearm['ixy']%></ixy>
                <ixz><%=base.forearm['ixz']%></ixz>
                <iyy><%=base.forearm['iyy']%></iyy>
                <iyz><%=base.forearm['iyz']%></iyz>
                <izz><%=base.forearm['izz']%></izz>
            </inertia>
        </inertial>

        <visual name='visual_forearm_link'>
            
            <geometry>
                <mesh>
                    <scale>1 1 1</scale>
                    <uri><%=base.mesh_v["forearm"]%></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(base.forearm['ambient'])%></ambient>
                <diffuse><%=a_to_s(base.forearm['diffuse'])%></diffuse>
                <specular><%=a_to_s(base.forearm['specular'])%></specular>
                <emissive><%=a_to_s(base.forearm['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_forearm_link'>
          
            <geometry>
                <mesh>
                    <scale>1 1 1</scale>
                    <uri><%=base.mesh_c["forearm"]%></uri>
                </mesh>
            </geometry>
        </collision>
    </link>
    
    <link name = "palm_link">
        <pose frame=''><%=a_to_s(base.palm['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(base.palm['pose_i'])%></pose>
            <mass><%=base.palm['mass']%></mass>
            <inertia>
                <ixx><%=base.palm['ixx']%></ixx>
                <ixy><%=base.palm['ixy']%></ixy>
                <ixz><%=base.palm['ixz']%></ixz>
                <iyy><%=base.palm['iyy']%></iyy>
                <iyz><%=base.palm['iyz']%></iyz>
                <izz><%=base.palm['izz']%></izz>
            </inertia>
        </inertial>
	  
        <visual name='visual_palm_link'>
            
            <geometry>
                <mesh>
                    <scale>-0.001 0.001 0.001</scale>
                    <uri><%= base.mesh_v["palm"] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(base.palm['ambient'])%></ambient>
                <diffuse><%=a_to_s(base.palm['diffuse'])%></diffuse>
                <specular><%=a_to_s(base.palm['specular'])%></specular>
                <emissive><%=a_to_s(base.palm['emissive'])%></emissive>
            </material>
        </visual>
        <collision name="collision_palm_link">
 
            <geometry>
                <mesh>
                    <scale>-0.001 0.001 0.001</scale>
                <uri><%= base.mesh_c["palm"] %></uri>
            </mesh>
            </geometry>
        </collision>

  
        
    </link>
    <joint name='palm_forearm' type='fixed'>
        <child>palm_link</child>
        <parent>forearm_link</parent>
        <axis>
            
            <xyz>0 -1 0</xyz>
         </axis>
    </joint>  


   <%fingers.each do |finger|%>
  
    <link name = "knuckle_link_<%=finger.fingername%>">
        
        <pose frame=''><%=a_to_s(finger.knuckle['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(finger.knuckle['pose_i'])%></pose>
            <mass><%=finger.knuckle['mass']%></mass>
            <inertia>
                <ixx><%=finger.knuckle['ixx']%></ixx>
                <ixy><%=finger.knuckle['ixy']%></ixy>
                <ixz><%=finger.knuckle['ixz']%></ixz>
                <iyy><%=finger.knuckle['iyy']%></iyy>
                <iyz><%=finger.knuckle['iyz']%></iyz>
                <izz><%=finger.knuckle['izz']%></izz>
            </inertia>
        </inertial>
      
        <visual name='visual_knuckle_link_<%=finger.fingername%>'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= ff.mesh_v['knuckle'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(finger.knuckle['ambient'])%></ambient>
                <diffuse><%=a_to_s(finger.knuckle['diffuse'])%></diffuse>
                <specular><%=a_to_s(finger.knuckle['specular'])%></specular>
                <emissive><%=a_to_s(finger.knuckle['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_knuckle_link_<%=finger.fingername%>'>
            <pose frame=''>0 0 0 0 1.5708 0</pose>
            <geometry>
                <cylinder>
                    <radius>0.007</radius> 
                    <length>0.014</length> 
                </cylinder> 
            </geometry>
        </collision>
    </link>
    <link name = "proximal_link_<%=finger.fingername%>">
        <pose frame=''><%=a_to_s(finger.proximal['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(finger.proximal['pose_i'])%></pose>
            <mass><%=finger.proximal['mass']%></mass>
            <inertia>
                <ixx><%=finger.proximal['ixx']%></ixx>
                <ixy><%=finger.proximal['ixy']%></ixy>
                <ixz><%=finger.proximal['ixz']%></ixz>
                <iyy><%=finger.proximal['iyy']%></iyy>
                <iyz><%=finger.proximal['iyz']%></iyz>
                <izz><%=finger.proximal['izz']%></izz>
            </inertia>
        </inertial>
        
        <visual name='visual_proximal_link_<%=finger.fingername%>'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= ff.mesh_v['proximal'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(finger.proximal['ambient'])%></ambient>
                <diffuse><%=a_to_s(finger.proximal['diffuse'])%></diffuse>
                <specular><%=a_to_s(finger.proximal['specular'])%></specular>
                <emissive><%=a_to_s(finger.proximal['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_proximal_link_<%=finger.fingername%>'>
            <pose frame=''>0 0 0.025 0 0 0</pose>
            <geometry>
                <cylinder>
                    <radius>0.007</radius> 
                    <length>0.040</length> 
                </cylinder> 
            </geometry>
        </collision>
    </link>
    <link name = "middle_link_<%=finger.fingername%>">
        <pose frame=''><%=a_to_s(finger.middle['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(finger.middle['pose_i'])%></pose>
            <mass><%=finger.middle['mass']%></mass>
            <inertia>
                <ixx><%=finger.middle['ixx']%></ixx>
                <ixy><%=finger.middle['ixy']%></ixy>
                <ixz><%=finger.middle['ixz']%></ixz>
                <iyy><%=finger.middle['iyy']%></iyy>
                <iyz><%=finger.middle['iyz']%></iyz>
                <izz><%=finger.middle['izz']%></izz>
            </inertia>
        </inertial>
      
        <visual name='visual_middle_link_<%=finger.fingername%>'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= ff.mesh_v['middle'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(finger.middle['ambient'])%></ambient>
                <diffuse><%=a_to_s(finger.middle['diffuse'])%></diffuse>
                <specular><%=a_to_s(finger.middle['specular'])%></specular>
                <emissive><%=a_to_s(finger.middle['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_middle_link_<%=finger.fingername%>'>
            <pose frame=''>0 0 0.0125 0 0 0</pose>
            <geometry>
                <cylinder>
                    <radius>0.007</radius> 
                    <length>0.025</length> 
                </cylinder> 
            </geometry>
        </collision>
    </link>
    <link name = "distal_link_<%=finger.fingername%>">
        <pose frame=''><%=a_to_s(finger.distal['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(finger.distal['pose_i'])%></pose>
            <mass><%=finger.distal['mass']%></mass>
            <inertia>
                <ixx><%=finger.distal['ixx']%></ixx>
                <ixy><%=finger.distal['ixy']%></ixy>
                <ixz><%=finger.distal['ixz']%></ixz>
                <iyy><%=finger.distal['iyy']%></iyy>
                <iyz><%=finger.distal['iyz']%></iyz>
                <izz><%=finger.distal['izz']%></izz>
            </inertia>
        </inertial>
      
        <visual name='visual_distal_link_<%=finger.fingername%>'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= ff.mesh_v['distal'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(finger.distal['ambient'])%></ambient>
                <diffuse><%=a_to_s(finger.distal['diffuse'])%></diffuse>
                <specular><%=a_to_s(finger.distal['specular'])%></specular>
                <emissive><%=a_to_s(finger.distal['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_distal_link_<%=finger.fingername%>'>
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= ff.mesh_c['distal'] %></uri>
                </mesh>
            </geometry>
        </collision>
    </link>
    
    <%j_finger_L.each do |f_L|%>
        <joint name="<%=f_L['j_name']%>_<%=finger.fingername%>" type="<%=f_L['j_type']%>">
            <child><%=f_L['name']%>_link_<%=finger.fingername%></child>
            <parent><%=f_L['p_name']%>_link_<%=finger.fingername%></parent>
            
            <axis>
                <xyz><%=a_to_s(f_L['j_axis'])%></xyz>
                <limit>
                    <lower><%=f_L['j_limit'][0]%> </lower>
                    <upper><%=f_L['j_limit'][1]%> </upper>
                    <effort><%=f_L['j_effort']%> </effort>
                    <velocity><%=f_L['j_velocity']%> </velocity>
                </limit>
                <dynamics>
                    <damping><%=f_L['j_damping']%></damping>
                    <friction><%=f_L['j_friction']%></friction>
                    <spring_reference>0</spring_reference>
                    <spring_stiffness>0</spring_stiffness>
                </dynamics>
            </axis>
        </joint>
    <%end%>
    <joint name='<%=ff.knuckle['j_name']%>_<%=finger.fingername%>' type="<%=ff.knuckle['j_type']%>">
        <child><%=ff.knuckle['name']%>_link_<%=finger.fingername%></child>
        <parent><%=ff.knuckle['p_name']%>_link</parent>
        
        <axis>
            <xyz><%=a_to_s(ff.knuckle['j_axis'])%></xyz>
            <limit>
                <lower><%=ff.knuckle['j_limit'][0]%> </lower>
                <upper><%=ff.knuckle['j_limit'][1]%> </upper>
                <effort><%=ff.knuckle['j_effort']%> </effort>
                <velocity><%=ff.knuckle['j_velocity']%> </velocity>
            </limit>
            <dynamics>
                <damping><%=ff.knuckle['j_damping']%></damping>
                <friction><%=ff.knuckle['j_friction']%></friction>
                <spring_reference>0</spring_reference>
                <spring_stiffness>0</spring_stiffness>
            </dynamics>
        </axis>
    </joint>

   <%end%>


    <link name = "thbase_link">
        <pose frame=''><%=a_to_s(thumb.thbase['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(thumb.thbase['pose_i'])%></pose>
            <mass><%=thumb.thbase['mass']%></mass>
            <inertia>
                <ixx><%=thumb.thbase['ixx']%></ixx>
                <ixy><%=thumb.thbase['ixy']%></ixy>
                <ixz><%=thumb.thbase['ixz']%></ixz>
                <iyy><%=thumb.thbase['iyy']%></iyy>
                <iyz><%=thumb.thbase['iyz']%></iyz>
                <izz><%=thumb.thbase['izz']%></izz>
            </inertia>
        </inertial>
        <visual name='visual_thbase_link'>
            
            <geometry>
                <box>
                    <size>0.001 0.001 0.001</size>
                </box>
            </geometry>
            <material>
                <ambient><%=a_to_s(thumb.thbase['ambient'])%></ambient>
                <diffuse><%=a_to_s(thumb.thbase['diffuse'])%></diffuse>
                <specular><%=a_to_s(thumb.thbase['specular'])%></specular>
                <emissive><%=a_to_s(thumb.thbase['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_thbase_link'>
            <pose frame=''>0 0 0 0 0 0</pose>
            <geometry>

                <sphere>
                    <radius>0.011</radius>
                </sphere>
               
            </geometry>
        </collision>
    </link>
    <link name = "thproximal_link">
            
        <pose frame=''><%=a_to_s(thumb.thproximal['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(thumb.thproximal['pose_i'])%></pose>
            <mass><%=thumb.thproximal['mass']%></mass>
            <inertia>
                <ixx><%=thumb.thproximal['ixx']%></ixx>
                <ixy><%=thumb.thproximal['ixy']%></ixy>
                <ixz><%=thumb.thproximal['ixz']%></ixz>
                <iyy><%=thumb.thproximal['iyy']%></iyy>
                <iyz><%=thumb.thproximal['iyz']%></iyz>
                <izz><%=thumb.thproximal['izz']%></izz>
            </inertia>
        </inertial>
    
        <visual name='visual_thproximal_link'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= thumb.mesh_v['thproximal'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(thumb.thproximal['ambient'])%></ambient>
                <diffuse><%=a_to_s(thumb.thproximal['diffuse'])%></diffuse>
                <specular><%=a_to_s(thumb.thproximal['specular'])%></specular>
                <emissive><%=a_to_s(thumb.thproximal['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_thproximal_link'>
            <pose frame=''>0 0 0.020 0 0 0</pose>
            <geometry>
                <cylinder>
                    <radius>0.012</radius>
                    <length>0.018</length>
                </cylinder>
            </geometry>
        </collision>
    </link>
    <link name = "thhub_link">
        <pose frame=''><%=a_to_s(thumb.thhub['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(thumb.thhub['pose_i'])%></pose>
            <mass><%=thumb.thhub['mass']%></mass>
            <inertia>
                <ixx><%=thumb.thhub['ixx']%></ixx>
                <ixy><%=thumb.thhub['ixy']%></ixy>
                <ixz><%=thumb.thhub['ixz']%></ixz>
                <iyy><%=thumb.thhub['iyy']%></iyy>
                <iyz><%=thumb.thhub['iyz']%></iyz>
                <izz><%=thumb.thhub['izz']%></izz>
            </inertia>
        </inertial>
        <visual name='visual_thhub_link'>
            
            <geometry>
                <box>
                    <size>0.001 0.001 0.001</size>
                </box>
            </geometry>
            <material>

            </material>
        </visual>
        <collision name='collision_thhub_link'>
            <geometry>
                <box>
                    <size>0.001 0.001 0.001</size>
                </box>
            </geometry>
        </collision>
    </link>
    <link name = "thmiddle_link">
            
        <pose frame=''><%=a_to_s(thumb.thmiddle['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(thumb.thmiddle['pose_i'])%></pose>
            <mass><%=thumb.thmiddle['mass']%></mass>
            <inertia>
                <ixx><%=thumb.thmiddle['ixx']%></ixx>
                <ixy><%=thumb.thmiddle['ixy']%></ixy>
                <ixz><%=thumb.thmiddle['ixz']%></ixz>
                <iyy><%=thumb.thmiddle['iyy']%></iyy>
                <iyz><%=thumb.thmiddle['iyz']%></iyz>
                <izz><%=thumb.thmiddle['izz']%></izz>
            </inertia>
        </inertial>

        <visual name='visual_thmiddle_link'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= thumb.mesh_v['thmiddle'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(thumb.thmiddle['ambient'])%></ambient>
                <diffuse><%=a_to_s(thumb.thmiddle['diffuse'])%></diffuse>
                <specular><%=a_to_s(thumb.thmiddle['specular'])%></specular>
                <emissive><%=a_to_s(thumb.thmiddle['emissive'])%></emissive>
            </material>
        </visual>

        <collision name='collision_thmiddle_link'>
            <pose frame=''>0 0 0.012 0 0 0</pose>
            <geometry>
                <cylinder>
                    <radius>0.011</radius>
                    <length>0.018</length>
                </cylinder>
            </geometry>
        </collision>
    </link>
    <link name = "thdistal_link">
            
        <pose frame=''><%=a_to_s(thumb.thdistal['pose'])%></pose>
        <inertial>
            <pose frame=''><%=a_to_s(thumb.thdistal['pose_i'])%></pose>
            <mass><%=thumb.thdistal['mass']%></mass>
            <inertia>
                <ixx><%=thumb.thdistal['ixx']%></ixx>
                <ixy><%=thumb.thdistal['ixy']%></ixy>
                <ixz><%=thumb.thdistal['ixz']%></ixz>
                <iyy><%=thumb.thdistal['iyy']%></iyy>
                <iyz><%=thumb.thdistal['iyz']%></iyz>
                <izz><%=thumb.thdistal['izz']%></izz>
            </inertia>
        </inertial>

        <visual name='visual_thdistal_link'>
            
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= thumb.mesh_v['thdistal'] %></uri>
                </mesh>
            </geometry>
            <material>
                <ambient><%=a_to_s(thumb.thdistal['ambient'])%></ambient>
                <diffuse><%=a_to_s(thumb.thdistal['diffuse'])%></diffuse>
                <specular><%=a_to_s(thumb.thdistal['specular'])%></specular>
                <emissive><%=a_to_s(thumb.thdistal['emissive'])%></emissive>
            </material>
        </visual>
        <collision name='collision_thdistal_link'>
            <geometry>
                <mesh>
                    <scale>0.001 0.001 0.001</scale>
                    <uri><%= thumb.mesh_c['thdistal']  %></uri>
                </mesh>
            </geometry>
        </collision>
    </link>
 
    <%j_thumb_L.each do |th_L|%>
        <joint name ="<%=th_L['j_name']%>"  type ="<%=th_L['j_type']%>">
            <child><%=th_L['name']%>_link</child>
            <parent><%=th_L['p_name']%>_link</parent>
            <axis>
                <xyz><%=a_to_s(th_L['j_axis'])%></xyz>
                <limit>
                    <lower><%=th_L['j_limit'][0]%> </lower>
                    <upper><%=th_L['j_limit'][1]%> </upper>
                    <effort><%=th_L['j_effort']%> </effort>
                    <velocity><%=th_L['j_velocity']%> </velocity>
                </limit>
                <dynamics>
                    <damping><%=th_L['j_damping']%></damping>
                    <friction><%=th_L['j_friction']%></friction>
                </dynamics>
            </axis>
        </joint>
    <%end%>
    <joint name ="<%=thumb.thhub['j_name']%>"  type ="<%=thumb.thhub['j_type']%>">
        <child><%=thumb.thhub['name']%>_link</child>
        <parent><%=thumb.thhub['p_name']%>_link</parent>
        <axis>
            <xyz><%=a_to_s(thumb.thhub['j_axis'])%></xyz>
        </axis>
    </joint>

 
    
</model>
</sdf>